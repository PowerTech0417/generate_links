<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ” OTT ç­¾å + çŸ­ç½‘å€ç”Ÿæˆå™¨</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    padding: 2em;
    max-width: 600px;
    margin: auto;
    background: radial-gradient(circle at top, #0a1a3a, #000);
    color: #fff;
  }
  h1 {
    text-align: center;
    background: linear-gradient(90deg, #00b7ff, #0078ff);
    -webkit-background-clip: text;
    color: transparent;
    font-size: 1.8em;
    font-weight: bold;
    margin-bottom: 1em;
    text-shadow: 0 0 12px #0078ff;
  }
  label { display: block; margin-top: 1em; font-weight: bold; }
  input, button {
    width: 100%;
    padding: .8em;
    margin-top: .5em;
    border-radius: 10px;
    border: 1px solid #0078ff;
    font-size: 1em;
  }
  input {
    background: #0d1b2a;
    color: #fff;
  }

  .generate-btn {
    background: linear-gradient(90deg, #ff004c, #ff7700);
    color: #fff;
    font-size: 1.1em;
    cursor: pointer;
    transition: 0.25s;
    border: none;
    box-shadow: 0 0 15px #ff3355;
  }
  .generate-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px #ff6600;
    background: linear-gradient(90deg, #ff6600, #ff0033);
  }

  pre {
    background: #0d1b2a;
    padding: 1em;
    border-radius: 10px;
    word-break: break-all;
    border: 1px solid #0078ff;
    margin-top: 0.5em;
  }

  .time-btns {
    display: flex;
    justify-content: space-between;
    margin-top: 1em;
    gap: 10px;
  }
  .time-btns button {
    flex: 1;
    background: linear-gradient(90deg, #0078ff, #00b7ff);
    border: none;
    box-shadow: 0 0 10px #0078ff;
    transition: 0.25s;
  }
  .time-btns button:hover {
    background: linear-gradient(90deg, #00b7ff, #0078ff);
    transform: scale(1.05);
  }

  footer {
    text-align: center;
    margin-top: 2.5em;
    font-size: 0.9em;
    color: #00e0ff;
    text-shadow: 0 0 12px #00e0ff;
    animation: glow 3s ease-in-out infinite alternate;
  }
  @keyframes glow {
    from { text-shadow: 0 0 8px #00e0ff, 0 0 16px #00e0ff; }
    to { text-shadow: 0 0 20px #ff004c, 0 0 40px #ff6600; color: #ffddcc; }
  }

  .hidden { display: none !important; }

  .lang-buttons {
    display: flex;
    justify-content: space-between;
    gap: 8px;
    margin-top: 1.5em;
  }
  .lang-buttons button {
    flex: 1;
    background: linear-gradient(90deg, #0078ff, #00b7ff);
    border: none;
    padding: 0.7em;
    border-radius: 10px;
    cursor: pointer;
    color: #fff;
    font-weight: bold;
    transition: 0.25s;
  }
  .lang-buttons button:hover {
    transform: scale(1.05);
    background: linear-gradient(90deg, #00b7ff, #0078ff);
  }
</style>
</head>
<body>

<h1>ğŸ” OTT é“¾æ¥ç­¾å + çŸ­ç½‘å€ç”Ÿæˆå™¨</h1>

<input id="secret" value="mySuperSecretKey" style="display:none">
<input id="domain" value="https://powertech.ott-1f4.workers.dev/" style="display:none">

<label>ç”¨æˆ· UID</label>
<input id="uid" placeholder="ä¾‹å¦‚ user123">

<label>è¿‡æœŸæ—¥æœŸæ—¶é—´ï¼ˆé©¬æ¥è¥¿äºšæ—¶é—´ï¼‰</label>
<input id="exp" type="datetime-local">

<div class="time-btns">
  <button type="button" onclick="setExpiryMonths(1)">ğŸ—“ï¸1ä¸ªæœˆ</button>
  <button type="button" onclick="setExpiryMonths(12)">ğŸ“† 1å¹´</button>
  <button type="button" onclick="setExpiryMonths(1200)">â™¾ï¸ æ°¸ä¹…</button>
</div>

<button class="generate-btn" onclick="generateFull()">ğŸš€ ç”Ÿæˆç­¾åå¹¶åˆ›å»ºçŸ­ç½‘å€</button>

<pre id="output" class="hidden"></pre>

<h3>ğŸ”— çŸ­ç½‘å€</h3>
<pre id="shortOutput">(ç”Ÿæˆä¸­...)</pre>
<button id="copyShortBtn" class="hidden" onclick="copyShortURL()">ğŸ“‹ å¤åˆ¶çŸ­ç½‘å€</button>
<button id="copyDescBtn" class="hidden" onclick="copyDescription()">ğŸ“„ å¤åˆ¶è¯´æ˜æ–‡å­—</button>

<div class="lang-buttons">
  <button onclick="toggleLang('cn')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
  <button onclick="toggleLang('en')">ğŸ‡¬ğŸ‡§ English</button>
  <button onclick="toggleLang('my')">ğŸ‡²ğŸ‡¾ Melayu</button>
</div>

<pre id="desc" class="hidden"></pre>

<footer>Â© 2025 @By PowerTech & Sky Mod</footer>

<script>
function getMalaysiaNow() {
  const now = new Date();
  return new Date(now.getTime() + 8 * 60 * 60 * 1000);
}
function setExpiryMonths(months) {
  const expInput = document.getElementById("exp");
  const malaysiaNow = getMalaysiaNow();
  if (months >= 1200) malaysiaNow.setFullYear(malaysiaNow.getFullYear() + 100);
  else malaysiaNow.setMonth(malaysiaNow.getMonth() + months);
  expInput.value = malaysiaNow.toISOString().slice(0,16);
}

async function hmacSHA256(text, secret) {
  const key = await crypto.subtle.importKey(
    "raw", new TextEncoder().encode(secret),
    { name: "HMAC", hash: "SHA-256" },
    false, ["sign"]
  );
  const sigBuf = await crypto.subtle.sign("HMAC", key, new TextEncoder().encode(text));
  return Array.from(new Uint8Array(sigBuf)).map(b => b.toString(16).padStart(2, "0")).join("");
}

async function generateFull() {
  try {
    const uid = document.getElementById("uid").value.trim();
    const secret = document.getElementById("secret").value.trim();
    const domain = document.getElementById("domain").value.trim();
    const expStr = document.getElementById("exp").value;
    if (!uid) { alert("è¯·è¾“å…¥ç”¨æˆ· UIDï¼"); return; } // æ£€æŸ¥UID
    if (!expStr) { alert("è¯·è®¾ç½®è¿‡æœŸæ—¶é—´ï¼"); return; } // æ£€æŸ¥è¿‡æœŸæ—¶é—´

    const expLocal = new Date(expStr);
    // è¿™é‡Œè¦æ³¨æ„ï¼š expLocalæ˜¯æœ¬åœ°æ—¶é—´ï¼Œéœ€è¦è°ƒæ•´ä»¥ç¡®ä¿ expMillis æ¥è¿‘ UTC/æœåŠ¡å™¨æ—¶é—´
    // å‡è®¾ expStr æ˜¯é©¬æ¥è¥¿äºšæ—¶é—´ (MYT, UTC+8)
    const expMillis = expLocal.getTime(); 

    const text = `${uid}:${expMillis}`;
    const sig = await hmacSHA256(text, secret);
    const longURL = `${domain}?uid=${encodeURIComponent(uid)}&exp=${expMillis}&sig=${sig}`;
    document.getElementById("output").textContent = longURL;

    // API Call
    const res = await fetch("https://short.ott-eaf.workers.dev/", {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ longURL })
    });
    const data = await res.json();

    if (data.shortURL) {
      document.getElementById("shortOutput").textContent = data.shortURL;
      document.getElementById("copyShortBtn").classList.remove('hidden');
      document.getElementById("copyDescBtn").classList.remove('hidden');
      
      // æˆåŠŸç”ŸæˆçŸ­ç½‘å€åï¼Œè‡ªåŠ¨è§¦å‘ä¸­æ–‡æ•™ç¨‹æ˜¾ç¤º
      toggleLang('cn'); 
    } else {
      alert("çŸ­ç½‘å€ç”Ÿæˆå¤±è´¥ï¼š" + (data.error || "æœªçŸ¥é”™è¯¯"));
    }
  } catch (err) {
    console.error("Error:", err);
    alert("ç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ã€‚");
  }
}

function formatDateMY(date) {
  // ä½¿ç”¨ 'en-GB' è·å– DD/MM/YYYY æ ¼å¼ï¼Œå¹¶æŒ‡å®šé©¬æ¥è¥¿äºšæ—¶åŒº
  const options = { 
    year: "numeric", 
    month: "2-digit", 
    day: "2-digit", 
    hour: '2-digit', 
    minute: '2-digit',
    hour12: false,
    timeZone: "Asia/Kuala_Lumpur" 
  };
  return date.toLocaleDateString("zh-CN", options) + " " + date.toLocaleTimeString("zh-CN", options);
}

function toggleLang(lang) {
  const shortURL = document.getElementById("shortOutput").textContent.trim();
  const uid = document.getElementById("uid").value.trim(); // <-- è·å– UID

  if (!shortURL || shortURL.includes("(ç”Ÿæˆä¸­")) {
    alert("è¯·å…ˆç”ŸæˆçŸ­ç½‘å€ï¼");
    return;
  }
  if (!uid) {
    alert("è¯·å…ˆè¾“å…¥ç”¨æˆ· UIDï¼");
    return;
  }

  // ç¡®ä¿ UID è¾“å…¥æ¡†æœ‰ç„¦ç‚¹ï¼Œå¹¶æ·»åŠ æç¤º
  document.getElementById("uid").focus();

  const now = new Date();
  const exp = new Date(document.getElementById("exp").value);
  const buyDate = formatDateMY(now);
  const expDate = formatDateMY(exp);
  
  // UID Display Line
  const uidLineCN = `ğŸ†” ç”¨æˆ·: **${uid}**`;
  const uidLineEN = `ğŸ†” User: **${uid}**`;
  const uidLineMY = `ğŸ†” Pengguna: **${uid}**`;

  let text = "";
  if (lang === "cn") {
    text = `ğŸ‡¨ğŸ‡³ ä¸­æ–‡è¯´æ˜ï¼š
---
ğŸ“² ä¸‹è½½ä¸å®‰è£… OTT åº”ç”¨

åœ¨ Play å•†åº— (Play Store)
æœç´¢å¹¶å®‰è£…ä»¥ä¸‹å…¶ä¸­ä¸€ä¸ªåº”ç”¨ï¼š

ğŸ”µ OTT TVï¼ˆç”µè§†ç‰ˆæœ¬ï¼‰
ğŸŸ¢ OTT PLAYERï¼ˆæ‰‹æœºç‰ˆæœ¬ï¼‰

âš ï¸ åªéœ€ä¸‹è½½å…¶ä¸­ä¸€ä¸ªå³å¯ï¼

ğŸ“± é«˜çº§ç‰ˆAPPä¸‹è½½é“¾æ¥ï¼š
   https://bit.ly/tt1733  
ï¼ˆå¦‚éœ€ä½¿ç”¨æ›´å¤šåŠŸèƒ½ï¼Œè¯·ä¸‹è½½é«˜çº§ç‰ˆï¼‰  
---
ğŸ§­ ä½¿ç”¨æ­¥éª¤ï¼š

1. æ‰“å¼€ OTT Player / TV åº”ç”¨
2. ç‚¹å‡»å³ä¸Šè§’ è®¾ç½® (Settings)
3. é€‰æ‹© Providerï¼ˆä¾›åº”å•†ï¼‰
4. ç‚¹å‡» Add Providerï¼ˆæ·»åŠ ä¾›åº”å•†ï¼‰
5. é€‰æ‹© Playlistï¼ˆæ’­æ”¾åˆ—è¡¨ï¼‰
6. è¾“å…¥ä»¥ä¸‹ URL å¹¶ç‚¹å‡» Applyï¼ˆåº”ç”¨ï¼‰

ğŸ“Œ âœ… 1 ä¸ªé“¾æ¥ä»…é™ 1 å°è®¾å¤‡ä½¿ç”¨ï¼
ğŸ‘‡ğŸ‘‡æ’­æ”¾åˆ—è¡¨ URL é“¾æ¥ğŸ‘‡ğŸ‘‡
ğŸ‘‰ **${shortURL}**

âš ï¸ â›”ï¸ åŒä¸€é“¾æ¥å¤šè®¾å¤‡ä½¿ç”¨å°†ä¼šè‡ªåŠ¨å°ç¦ï¼
ğŸš« åˆ«ç”¨å…¶ä»–è®¾å¤‡æ‰“å¼€ ID é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å°ç¦ï¼`;
${uidLineCN}
ğŸ•’ è´­ä¹°æ—¥æœŸï¼š**${buyDate}**
ğŸ“… åˆ°æœŸæ—¥æœŸï¼š**${expDate}**
  } 
  else if (lang === "en") {
    text = `ğŸ‡¬ğŸ‡§ English Instructions:
---
ğŸ“² Download & Install OTT App

Go to Play Store and search for OTT.
Download one of the following apps:

ğŸ”µ OTT TV (for TV)
ğŸŸ¢ OTT PLAYER (for mobile)

âš ï¸ Download only ONE of them!
ğŸ“± Premium APP download link: 
   https://bit.ly/tt1733  
(Download the premium version for extra features) 
---
ğŸ§­ Setup Steps:

1. Open OTT Player / TV app
2. Tap the Settings icon
3. Select Provider
4. Tap Add Provider
5. Choose Playlist
6. Enter the URL below and click Apply

ğŸ“Œ âœ… 1 URL for 1 Device Only!
ğŸ‘‡ğŸ‘‡ Playlist URL Link ğŸ‘‡ğŸ‘‡
ğŸ‘‰ **${shortURL}**

âš ï¸ â›”ï¸ If used on multiple devices, it will be auto-banned!
ğŸš« Do NOT open the ID link on other devices â€” it will be auto-banned!`;
${uidLineEN}
ğŸ•’ Purchase Date: **${buyDate}**
ğŸ“… Expiry Date: **${expDate}**
  } 
  else {
    text = `ğŸ‡²ğŸ‡¾ Bahasa Melayu:
---
ğŸ“² Muat Turun & Pasang Aplikasi OTT

Buka Play Store dan cari â€œOTTâ€
Pasang salah satu aplikasi berikut:

ğŸ”µ OTT TV (Versi TV)
ğŸŸ¢ OTT PLAYER (Versi telefon)

âš ï¸ Muat turun satu sahaja!
ğŸ“± Pautan muat turun APP Premium: 
   https://bit.ly/tt1733  
(Muat turun versi premium untuk ciri tambahan)  
---
ğŸ§­ Langkah Penggunaan:

1. Buka aplikasi OTT Player / TV
2. Tekan ikon Tetapan (Settings)
3. Pilih Provider (Penyedia)
4. Tekan Add Provider (Tambah Penyedia)
5. Pilih Playlist (Senarai Main)
6. Masukkan URL di bawah dan tekan Apply

ğŸ“Œ âœ… 1 URL hanya untuk 1 peranti sahaja!
ğŸ‘‡ğŸ‘‡ Playlist Pautan Akaun URL ğŸ‘‡ğŸ‘‡
ğŸ‘‰ **${shortURL}**

âš ï¸ â›”ï¸ Jika digunakan pada lebih daripada satu peranti, akaun akan diharamkan!
ğŸš« Jangan buka pautan ID pada peranti lain â€” ia akan diharamkan secara automatik!`;
 ${uidLineMY}
ğŸ•’ Tarikh Pembelian: **${buyDate}**
ğŸ“… Tarikh Tamat: **${expDate}**
  }

  const desc = document.getElementById("desc");
  desc.textContent = text;
  desc.classList.remove("hidden");
}

async function copyShortURL() {
  const text = document.getElementById("shortOutput").textContent.trim();
  try { await navigator.clipboard.writeText(text); alert("çŸ­ç½‘å€å·²å¤åˆ¶ï¼");} catch (e) { alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚");}
}

async function copyDescription() {
  const text = document.getElementById("desc").textContent.trim();
  if (!text) { alert("è¯·å…ˆç”ŸæˆçŸ­ç½‘å€å¹¶é€‰æ‹©è¯­è¨€ï¼"); return; }
  try { await navigator.clipboard.writeText(text); alert("è¯´æ˜æ–‡å­—å·²å¤åˆ¶ï¼");} catch (e) { alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚");}
}

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è®¾ç½® 1 å¹´è¿‡æœŸæ—¶é—´
document.addEventListener('DOMContentLoaded', () => {
    setExpiryMonths(12);
});
</script>
</body>
  </html>
