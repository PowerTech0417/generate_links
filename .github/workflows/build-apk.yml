name: ðŸ“¦ Build PWA Android APK

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: â˜• Setup JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ðŸ§± Install Bubblewrap CLI
        run: npm install -g @bubblewrap/cli

      - name: ðŸ§© Create Bubblewrap config manually
        run: |
          mkdir -p ./twa
          cat > twa/config.json <<'EOF'
          {
            "manifestUrl": "https://powertech0417.github.io/generate_links/manifest.json",
            "host": "powertech0417.github.io",
            "startUrl": "/generate_links/",
            "name": "generate_links",
            "launcherName": "generate_links",
            "display": "standalone",
            "themeColor": "#000000",
            "backgroundColor": "#0a1a3a",
            "navigationColor": "#000000",
            "navigationColorDark": "#000000",
            "navigationDividerColor": "#000000",
            "navigationDividerColorDark": "#000000",
            "orientation": "portrait",
            "fullScopeUrl": "https://powertech0417.github.io/generate_links/",
            "generatorApp": "bubblewrap-cli",
            "versionCode": 1,
            "versionName": "1.0",
            "fallbackType": "customtabs",
            "signingKey": {
              "path": "./android.keystore",
              "alias": "my-key-alias",
              "password": "android",
              "keystorePassword": "android"
            }
          }
          EOF

      - name: ðŸ—ï¸ Build APK (silent)
        run: |
          cd twa
          npx bubblewrap build --nonInteractive

      - name: ðŸ“¦ Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: PowerTech-OTT-Generator
          path: twa/output/app-release.apk
