name: ðŸ“¦ Build PWA Android APK

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ðŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: â˜• Setup JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ðŸ§± Install Bubblewrap CLI
        run: npm install -g @bubblewrap/cli

      - name: ðŸ§© Create Bubblewrap config (skip init)
        run: |
          mkdir -p twa
          cd twa
          echo "âœ… Creating twa-manifest.json & config.json manually"
          cat > twa-manifest.json <<'EOF'
          {
            "packageId": "com.powertech.generate_links",
            "name": "PowerTech OTT ç”Ÿæˆå™¨",
            "startUrl": "https://powertech0417.github.io/generate_links/",
            "display": "standalone",
            "themeColor": "#000000",
            "backgroundColor": "#0a1a3a",
            "iconUrl": "https://raw.githubusercontent.com/PowerTech0417/generate_links/refs/heads/main/icon-512.png",
            "generatorApp": "bubblewrap-cli",
            "fullScopeUrl": "https://powertech0417.github.io/generate_links/"
          }
          EOF

          cat > config.json <<'EOF'
          {
            "manifestUrl": "https://powertech0417.github.io/generate_links/manifest.json",
            "host": "powertech0417.github.io",
            "name": "PowerTech OTT Generator",
            "launcherName": "OTT Generator",
            "display": "standalone",
            "themeColor": "#000000",
            "backgroundColor": "#0a1a3a",
            "navigationColor": "#000000",
            "orientation": "portrait",
            "fullScopeUrl": "https://powertech0417.github.io/generate_links/",
            "versionCode": 1,
            "versionName": "1.0.0",
            "signingKey": {
              "path": "./android.keystore",
              "alias": "key",
              "password": "android",
              "keystorePassword": "android"
            }
          }
          EOF

      - name: ðŸ—ï¸ Build APK
        run: |
          cd twa
          echo "âœ… Building APK..."
          npx bubblewrap build --nonInteractive --skipPwaValidation

      - name: ðŸ“¦ Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: PowerTech-OTT-Generator
          path: twa/output/app-release.apk
